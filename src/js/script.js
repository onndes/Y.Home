"use strict";
// ===============================================================================================================
// isMobile
// ===============================================================================================================
// prettier-ignore
let isMobile = {
	Android: function() {return navigator.userAgent.match(/Android/i);},
	BlackBerry: function() {return navigator.userAgent.match(/BlackBerry/i);},
	iOS: function() {return navigator.userAgent.match(/iPhone|iPad|iPod/i);},
	Opera: function() {return navigator.userAgent.match(/Opera Mini/i);},
	Windows: function() {return navigator.userAgent.match(/IEMobile/i);},
	any: function() {return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());}
};

// ===============================================================================================================
// slick-slider check-comforts
// ===============================================================================================================
$(".slider-for").slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    arrows: false,
    asNavFor: ".slider-nav",
    waitForAnimate: false,
});
$(".slider-nav").slick({
    slidesToShow: 4,
    slidesToScroll: 1,
    asNavFor: ".slider-for",
    arrows: false,
    dots: false,
    centerMode: false,
    focusOnSelect: true,
    mobileFirst: true,
    variableWidth: true,
    waitForAnimate: false,
    responsive: [
        {
            breakpoint: 300,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 1,
            },
        },
        {
            breakpoint: 420,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 1,
            },
        },
        {
            breakpoint: 768,
            settings: {
                slidesToShow: 5,
                slidesToScroll: 1,
            },
        },
    ],
});

// =========================================================================================================================================================================================================================================================================================================================================================
// button - select slider and change bacground color
// =========================================================================================================================================================================================================================================================================================================================================================
$(document).on("click", ".check-comforts__link", function () {
    const $this = $(this);
    $(".check-comforts__link").removeClass("select");
    $this.addClass("select");
    $(".slider-for").slick("slickGoTo", 0);
    switch ($this.data("filter")) {
        case "lobby":
            toggleCalssSlider($("#lobby"));
            $(".check-comforts").css("background", "#D6EBEE");
            return;
        case "delux-twin-rooms":
            toggleCalssSlider($("#delux-twin-rooms"));
            $(".check-comforts").css("background", "rgb(228, 228, 228)");
            return;
        case "dormitory-rooms":
            toggleCalssSlider($("#dormitory-rooms"));
            $(".check-comforts").css("background", "rgb(239, 241, 254)");
            return;
        case "for-bed-mixed":
            toggleCalssSlider($("#for-bed-mixed"));
            $(".check-comforts").css("background", "rgb(237, 244, 234)");
            return;
    }
});

function toggleCalssSlider(n) {
    $(".check-comforts__slider-box").removeClass("active");
    n.addClass("active");
    $(".slider-for").slick("setPosition");
}

// =========================================================================================================================================================================================================================================================================================================================================================
//  Button Scroll top
// =========================================================================================================================================================================================================================================================================================================================================================
const upTop = $(".uptop");
upTop.on("click", handleScrollTop);
function handleScrollTop(e) {
    const interval = setInterval(() => {
        const st = window.pageYOffset;
        if (st <= 0) {
            clearInterval(interval);
        }

        window.scrollBy(0, -65);
        upTop.addClass("none");
    }, 3);
}
$(document).on("mousewheel", handleOnScrollTop);
if (window.pageYOffset < 400) {
    upTop.addClass("none");
}
function handleOnScrollTop() {
    if (window.pageYOffset >= 400) {
        upTop.removeClass("none");
        return;
    }
    upTop.addClass("none");
}

// =========================================================================================================================================================================================================================================================================================================================================================
//  Burger menu
// =========================================================================================================================================================================================================================================================================================================================================================
const menuBtn = $("#menu-btn");
const mobileMenu = $("#mobile-menu");
const isSubMenuArrow = $(".menu__arrow");
const hasSubMenu = $(".has-submenu");
const linkBurgerMenu = $(".header-mobile__menu-link");

menuBtn.on("click", handleBurgerMenu);
isSubMenuArrow.on("click", handeClickIsSubMenu);
linkBurgerMenu.on("click", function () {
    resetMobileMenu();
});

function resetHasSubMenu() {
    hasSubMenu.siblings("li").children(".is-submenu").removeClass("opened").siblings("ul").hide();
    hasSubMenu.siblings("li").find(".menu__arrow").removeClass("opened");
}

function handleBurgerMenu() {
    const $this = $(this);
    $this.toggleClass("active");
    mobileMenu.slideToggle(300);
    resetHasSubMenu();
}
function resetMobileMenu() {
    menuBtn.removeClass("active");
    mobileMenu.hide(300);
    resetHasSubMenu();
}

function handeClickIsSubMenu() {
    const $this = $(this);
    $this.toggleClass("opened");
    $this.next("ul").slideToggle(200);
    $this.parent(hasSubMenu).siblings("li").children(".is-submenu").removeClass("opened").siblings("ul").hide(300);
    $this.parent(hasSubMenu).siblings("li").find(".menu__arrow").removeClass("opened");
}

// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
// smooth scroll
// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
const scroll = new SmoothScroll("a[href*='#']", {});

// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
// Desktop menu
// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
// эфект при клике на меню desktop
// const desktopMenuLi = $(".header__menu > .header__menu-li");
// if (!isMobile.any()) {
//     desktopMenuLi.on("click", handleClickDesktopMenu);
//     function handleClickDesktopMenu() {
//           const $this = $(this);
//           desktopMenuLi.removeClass("selected");
//           $this.addClass("selected");
//     }
// }
const body = $("body");
if (isMobile.any()) {
    body.addClass("touch");
    const desktopArrow = $(".desktop-arrow");
    $(".header__menu-li_has-sub-li").addClass("parent-arrow");
    desktopArrow.on("click", handeleClickArrowMenu);
    function handeleClickArrowMenu() {
        $(this).next("ul").toggleClass("opened");
        $(this).closest("li").siblings("li").find("ul").removeClass("opened");
    }
} else {
    body.addClass("mouse");
}
function resetDesktopMenu() {
    $(".header__sub-list").removeClass("opened");
}
// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
// Validate form
// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

if (document.getElementById("form")) {
    const form = document.getElementById("form");
    form.addEventListener("submit", formSend);
}

function formSend(e) {
    e.preventDefault();
    let error = formValidate();
    if (error === 0) {
        console.log("Отправка формы");
    }
}

function formValidate() {
    let error = 0;
    let formReq = document.querySelectorAll("._req");
    formReq.forEach((el) => {
        formRemoveError(el);
        console.log(el);
        if (el.classList.contains("_email")) {
            if (!emailTest(el.value)) {
                formAddError(el);
                error++;
            }
        } else if (el.classList.contains("_nog")) {
            if (el.value === "") {
                formAddError(el);
                error++;
            }
            if (el.value > 10) {
                formAddError(el, el.value);
                error++;
            }
        } else if (el.classList.contains("_check-in")) {
            if (el.value === "") {
                formAddError(el);
                error++;
            }
        } else if (el.classList.contains("_check-out")) {
            if (el.value === "") {
                formAddError(el);
                error++;
            }
        }
    });

    return error;
}

function formAddError(input, val) {
    input.parentElement.classList.add("_error");
    if (input.nextElementSibling !== null && val > 10) {
        input.nextElementSibling.classList.add("_error");
    }
    input.classList.add("_error");
}
function formRemoveError(input) {
    input.parentElement.classList.remove("_error");
    if (input.nextElementSibling !== null) {
        input.nextElementSibling.classList.remove("_error");
    }
    input.classList.remove("_error");
}

function emailTest(input) {
    // prettier-ignore
    const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(String(input).toLowerCase());
}

const input = $(".top-block__input");
input.on("click", function () {
    $(this).removeClass("_error");
});
// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
// Validate form Contact US
// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

const usForm = $("#us-form");
usForm.bind("submit", usSendForm);

function usSendForm(e) {
    e.preventDefault();
    let error = usFormValidate();
    if (error === 0) {
        console.log("отправка формы");
    }
}
function usFormValidate() {
    let error = 0;
    let usFormReq = $("._us-req");
    usFormReq.each((idx, el) => {
        formRemoveError(el);
        const $el = $(el);
        if ($el.hasClass("_us-email")) {
            if (!emailTest(el.value)) {
                formAddError(el);
                error++;
            }
        } else if ($el.hasClass("_us-name") || $el.hasClass("_us_subject") || $el.hasClass("_us-message")) {
            if (el.value.trim() === "") {
                formAddError(el);
                error++;
            }
        } else if ($el.hasClass("_us-phone")) {
            if (!phoneTest(el.value)) {
                formAddError(el);
                error++;
            }
        }
    });
    return error;
}

function phoneTest(el) {
    let regex = /^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g;
    return regex.test(el);
}

const inputClear = $("._us-req");
inputClear.on("click", function () {
    $(this).removeClass("_error");
});

// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
// Validate form on page single
// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
const sinForm = $("#sin-form");
sinForm.bind("submit", sinSendForm);

function sinSendForm(e) {
    e.preventDefault();
    let error = sinFormValidate();
    if (error === 0) {
        console.log("отправка формы");
    }
}
function sinFormValidate() {
    let error = 0;
    let sinFormReq = $("._sin-req");
    sinFormReq.each((idx, el) => {
        formRemoveError(el);
        const $el = $(el);
        if ($el.hasClass("_sin-check-in") || $el.hasClass("_sin-check-out")) {
            if (el.value.trim() === "") {
                formAddError(el);
                error++;
            }
        } else if ($el.hasClass("_sin-nog")) {
            if (el.value === "") {
                formAddError(el);
                error++;
            }
            if (el.value > 10) {
                formAddError(el, el.value);
                error++;
            }
        }
    });
    return error;
}

const sinInputClear = $("._sin-req");
sinInputClear.on("click", function () {
    $(this).removeClass("_error");
});

// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
// FAQ open
// =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
const faqTitle = $(".faq__question-title");
const faqText = $(".faq__question-text");

faqTitle.on("click", handleCliclFaqTitle);
function handleCliclFaqTitle() {
    const $this = $(this);
    $this.toggleClass("open");
    $this.next("p").slideToggle(300);
    $this.parent("div").siblings("div").children("h4").removeClass("open");
    $this.parent("div").siblings("div").children("p").hide(300);
}

// =========================================================================================================================================================================================================================================================================================================================================================
//  Slider in block --- bed-breakfast
// =========================================================================================================================================================================================================================================================================================================================================================
const slider = $("#slider");
slider.slick({
    arrows: false,
    dots: true,
    appendDots: ".mydots",
    dotsClass: "dots-box",
    waitForAnimate: false,
});

// =========================================================================================================================================================================================================================================================================================================================================================
//  Slider in block ---single-slider
// =========================================================================================================================================================================================================================================================================================================================================================
const sinSlider = $("#sin-slider");
sinSlider.slick({
    dots: true,
    appendDots: ".sin-mydots",
    dotsClass: "sin-dots-box",
    waitForAnimate: false,
    centerMode: true,
    mobileFirst: true,
    autoplay: true,
    autoplaySpeed: 2000,
    pauseOnDotsHover: true,
    responsive: [
        {
            breakpoint: 640,
            settings: {
                adaptiveHeight: false,
                variableWidth: false,
            },
        },
        {
            breakpoint: 992,
            settings: {
                adaptiveHeight: false,
                variableWidth: true,
            },
        },
    ],
});

// =========================================================================================================================================================================================================================================================================================================================================================
//  open text, on page single ↓↓↓↓↓↓↓↓↓↓
// =========================================================================================================================================================================================================================================================================================================================================================
const singleSpanOpen = $(".sin-penthouse__text-span");
const singleBlockOpen = $(".sin-penthouse__hide-p-block");
singleSpanOpen.on("click", handleSingleOpenText);
function handleSingleOpenText() {
    singleBlockOpen.slideToggle(300);
}

// =========================================================================================================================================================================================================================================================================================================================================================
//  SSM ↓↓↓↓↓↓↓↓↓↓
// =========================================================================================================================================================================================================================================================================================================================================================
function initMobile() {
    if (window.pageYOffset >= 400) upTop.removeClass("none");
    resetDesktopMenu();
    console.log("is-mobile");
}

function initDesktop() {
    // upTop.addClass("none");
    resetMobileMenu();

    console.log("is-desktop");
}

ssm.addState({
    id: "tablet",
    query: "(max-width: 992px)",
    onEnter: function () {
        initMobile();
    },
});

ssm.addState({
    id: "desktop",
    query: "(min-width: 992px)",
    onEnter: function () {
        initDesktop();
    },
});
